<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Girl, Get Up! Flipbook</title>

  <!-- Your main styles -->
  <link rel="stylesheet" href="css/style.css">

  <!-- Optional: PageFlip core styles from CDN -->
  

  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      text-align: center;
      padding: 2rem;
      background: #f9f9f9;
    }
    /* Gate UI */
    #gate {
      max-width: 400px;
      margin: 2rem auto;
    }
    #gate input {
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    #gate button {
      margin-top: 1rem;
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      background: #111;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    /* Flipbook container */
    #flipbookContainer {
      display: none;
      width: 100%;
      height: 80vh;
      margin: 0 auto;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }
    #flipbook {
      width: 100%;
      height: 100%;
    }
    #gate h2 { margin-bottom: 8px; }
#accessCodeInput:focus { outline: 2px solid #111; }
#flipbookContainer { background:#fff; max-width: 1200px; }
/* Watermark overlay */
#flipbookContainer { position: relative; } /* ensure overlay positions correctly */
#flipbookContainer::after {
  content: "Girl, Get Up! ©";
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  pointer-events: none;
  user-select: none;
  font: 700 48px/1 sans-serif;
  color: rgba(0,0,0,0.12);
  transform: rotate(-25deg);
  letter-spacing: 2px;
}
#flipbook { background:#fff; }
/* Keep FS button pinned in fullscreen */
#flipbookContainer:fullscreen #fsBtn,
#flipbookContainer:-webkit-full-screen #fsBtn {
  position: fixed;
  top: 12px;
  right: 12px;
  z-index: 9999;
}
/* Disable printing from this page */
@media print {
  body { display: none !important; }
}

  </style>
</head>
<body>

  <!-- ACCESS GATE -->
  <section id="gate">
  <h2>Enter Access Code</h2>
  <input id="accessCodeInput" placeholder="Enter your unique code"/>
  <button
    id="unlockButton"
    type="button"
    onclick="tryUnlock(document.getElementById('accessCodeInput').value.trim())"
  >
    Unlock Flipbook
  </button>
</section>


  <div id="flipbookContainer">
    <button id="fsBtn" style="position:absolute;right:12px;top:12px;z-index:10">Fullscreen</button>
    <div id="flipbook"></div>
    <div id="spinner" style="display:none;padding:12px">Loading…</div>
</div>



<!-- PDF.js from CDN (must load before PageFlip when using loadFromPDF) -->
<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@2.16.105/build/pdf.min.js"></script>
<script>
  if (window.pdfjsLib) {
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdn.jsdelivr.net/npm/pdfjs-dist@2.16.105/build/pdf.worker.min.js";
  }
</script>

<!-- PageFlip (browser build) -->
<script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.min.js"></script>

<!-- Your inline code -->
<script>

  // --- CONFIG ---
const CORRECT_CODE = "GGU2025";   // <— live access code
const ATTEMPT_LIMIT = 5;                   // tries before temporary lock
const LOCK_SECONDS = 120;                  // lockout duration
// --------------

// read access code from URL (supports ?access=, ?code=, ?Access=, or #CODE)
(() => {
  const u = new URL(location.href);
  const raw =
    u.searchParams.get('access') ||
    u.searchParams.get('code')   ||
    u.searchParams.get('Access') ||
    (u.hash ? u.hash.replace(/^#/, '') : '') || '';

  const urlCode = decodeURIComponent(raw).trim();
  if (urlCode) tryUnlock(urlCode);
})();


// simple state
let attempts = 0;
let lockedUntil = 0;

// small helper
function nowSec(){ return Math.floor(Date.now()/1000); }

function showErr(msg){
  let box = document.getElementById("errorBox");
  if(!box){
    box = document.createElement("div");
    box.id = "errorBox";
    box.style.cssText =
      "position:fixed;left:50%;top:16px;transform:translateX(-50%);" +
      "max-width:720px;padding:10px 14px;border-radius:8px;" +
      "background:#fee;color:#a00;border:1px solid #f99;z-index:99999;";
    document.body.appendChild(box);
  }
  box.textContent = msg;
}


async function tryUnlock(inputCode){
  const t = nowSec();
  if (t < lockedUntil) {
    const wait = lockedUntil - t;
    showErr(`Too many attempts. Try again in ${wait}s.`);
    return;
  }
  if (!inputCode) {
    document.getElementById('accessCodeInput').focus();
    return;
  }
  if (inputCode !== CORRECT_CODE) {
    attempts++;
    if (attempts >= ATTEMPT_LIMIT) {
      lockedUntil = nowSec() + LOCK_SECONDS;
      attempts = 0;
      showErr(`Too many attempts. Locked for ${LOCK_SECONDS}s.`);
    } else {
      showErr(`Invalid code. ${ATTEMPT_LIMIT - attempts} attempt(s) left.`);
    }
    return;
  }
  // success
  document.getElementById('gate').style.display = 'none';
  await initFlipbook();
}

document.getElementById('unlockButton').addEventListener('click', () => {
  tryUnlock(document.getElementById('accessCodeInput').value.trim());
});
// Ensure Enter key submits the code
document.getElementById('accessCodeInput').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') tryUnlock(e.target.value.trim());
});




   async function pdfReachable(path){
  try {
    const r = await fetch(path, { method: 'GET', cache: 'no-store' });
    return r.ok;
  } catch { return false; }
}

async function renderPdfToImages(path){
  const pdf = await pdfjsLib.getDocument(path).promise;
  const images = [];
  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({ scale: 2 }); // crisp
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = viewport.width;
    canvas.height = viewport.height;
    await page.render({ canvasContext: ctx, viewport }).promise;
    images.push(canvas.toDataURL('image/png'));
  }
  return images;
}

async function initFlipbook() {
  const container = document.getElementById('flipbookContainer');
  const el = document.getElementById('flipbook');
  const spinner = document.getElementById('spinner');
const PDF_PATH = '/pdf/Girl-Get-Up-Flipbook.pdf';


  // (No pre-check, let loadFromPDF handle errors)


  container.style.display = 'block';
  spinner.style.display = 'block';

  const width  = el.clientWidth;
  const height = el.clientHeight;

  const flip = new St.PageFlip(el, {
    width, height,
    size: 'stretch',
    minWidth: 315, maxWidth: 2000,
    minHeight: 400, maxHeight: 2000,
    showCover: true,
    drawShadow: true,
    flippingTime: 800,
    mobileScrollSupport: false,
    useMouseEvents: true,
    disableFlipByClick: false,
    showPageCorners: true,
    useKeyboard: true,
    responsive: true
  });

 // NEW
try {
  // 1) Render PDF pages to data-URL strings
  const srcs = await renderPdfToImages(PDF_PATH);
  if (!srcs.length) throw new Error('No pages rendered from PDF');

  // 2) Turn those strings into real <img> elements
  const images = srcs.map((src) => {
    const img = new Image();
    img.src = src;
    img.draggable = false;
    img.loading = 'eager';
    img.style.width = '100%';
    img.style.height = 'auto';
    return img;
  });

  // 3) Load into PageFlip
  await flip.loadFromImages(images);
} catch (e) {
  showErr('Failed to load PDF: ' + e.message);
} finally {
  spinner.style.display = 'none';
}




document.getElementById('fsBtn')?.addEventListener('click', () => {
  const el = document.getElementById('flipbookContainer');
  if (!document.fullscreenElement) {
    el.requestFullscreen?.();
  } else {
    document.exitFullscreen?.();
  }
});
// Block right-click menu
document.addEventListener('contextmenu', (e) => e.preventDefault());

// Block common “save/print/view-source” shortcuts
document.addEventListener('keydown', (e) => {
  const k = e.key.toLowerCase();
  const meta = e.metaKey || e.ctrlKey;
  if (
    (meta && (k === 'p' || k === 's' || k === 'u' || k === 'o')) || // Cmd/Ctrl+P/S/U/O
    (e.shiftKey && meta && (k === 'i' || k === 'j' || k === 'c'))   // Devtools combos
  ) {
    e.preventDefault();
    e.stopPropagation();
  }
});

// Block dragging images/canvas
document.addEventListener('dragstart', (e) => e.preventDefault());

  </script>

</body>
</html>


